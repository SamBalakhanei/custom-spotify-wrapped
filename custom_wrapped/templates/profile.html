{% extends "_base.html" %}
{% load i18n %}

{% block content %}
    <div class="container text-text">
        {% if user.is_authenticated %}
            <h1 class="text-4xl text-center font-bold pt-10">{% trans "This is " %}{{ user.username }}{% trans "'s profile." %}</h1>
            <div class="flex space-x-4 items-center justify-center">
                <div class="p-10 flex space-x-4 items-center justify-center w-1/2">
                    <a href="{% url 'index' %}" class="flex-1">
                        <button class="flex flex-col items-center justify-center w-full focus:outline-none text-white bg-accent font-medium rounded-lg text-sm px-5 py-2.5">
                            <p class="text-center text-white">{% trans "Go Back" %}</p>
                        </button>
                    </a>
                   
                    <a href="{% url 'delete_account' %}" class="flex-1">
                        <button class="flex flex-col items-center justify-center w-full focus:outline-none text-white font-medium rounded-lg text-sm px-5 py-2.5" style="background-color: red">
                            <p class="text-center">{% trans "Delete Account" %}</p>
                        </button>
                    </a>
                </div>
            </div>

            <!-- Friends Section -->
            <div name="friends" class="items-center justify-center text-center">
                
                <!-- Add Friend -->
                <div name="friends-add">
                    <form method="POST" action="{% url 'send_friend_request' %}">
                        {% csrf_token %}
                        <input type="text" name="username" placeholder={% trans "Enter username" %} class="h-full border-2 border-accent" style="color: black">
                        <button type="submit" class="bg-green rounded-2xl border-2 border-accent px-4 ml-2 text-white">{% trans "Add" %}</button>
                    </form>
                </div>
                
                <!-- Outgoing Requests -->
                <div class="mt-8">
                    <h2 class="text-2xl font-bold">{% trans "Outgoing Requests" %}</h2>
                    <div class="flex-col">
                        {% for request in outgoing_requests %}
                            <div class="flex justify-center items-center space-x-2">
                                <span class="text-text">{{ request.friend.username }}</span>
                                <a href="{% url 'cancel_friend_request' request.id %}" class="bg-red-500 rounded-2xl border-2 border-accent px-4 text-white">{% trans "Cancel" %}</a>
                            </div>
                        {% empty %}
                            <p>{% trans "No outgoing requests" %}</p>
                        {% endfor %}
                    </div>
                </div>
                
                <!-- Incoming Requests -->
                <div class="mt-8">
                    <h2 class="text-2xl font-bold">{% trans "Incoming Requests" %}</h2>
                    <div class="flex-col">
                        {% for request in incoming_requests %}
                            <div class="flex justify-center items-center space-x-2">
                                <span class="text-text">{{ request.user.username }}</span>
                                <a href="{% url 'accept_friend_request' request.id %}" class="bg-green-500 rounded-2xl border-2 border-accent px-4 text-white">{% trans "Accept" %}</a>
                                <a href="{% url 'deny_friend_request' request.id %}" class="bg-red-500 rounded-2xl border-2 border-accent px-4 text-white">{% trans "Deny" %}</a>
                            </div>
                        {% empty %}
                            <p>{% trans "No incoming requests" %}</p>
                        {% endfor %}
                    </div>
                </div>
                
                <!-- Friends List -->
                <div class="mt-8">
                    <h2 class="text-2xl font-bold">{% trans "Friends" %}</h2>
                    <div class="flex-col">
                        {% for friend in friends %}
                            {% if friend.user == request.user %}
                                {% with friend_id=friend.friend.id %}
                                <div class="flex justify-center items-center space-x-2">
                                    <span class="text-text">{{ friend.friend.username }}</span>
                                    <button class="bg-green rounded-2xl border-2 border-accent px-4 ml-2 text-white">{% trans "View Duo-Wrapped" %}</button>
                                    
                                    <!-- Remove Friend Link -->
                                    <a href="{% url 'remove_friend' friend_id %}" 
                                       class="rounded-2xl px-4 ml-2 text-white" style="background-color: red">X</a>
                                </div>
                                {% endwith %}
                            {% else %}
                                {% with friend_id=friend.user.id %}
                                <div class="flex justify-center items-center space-x-2">
                                    <span class="text-text">{{ friend.user.username }}</span>
                                    <button class="bg-green rounded-2xl border-2 border-accent px-4 ml-2 text-white">{% trans "View Duo-Wrapped" %}</button>
                                    
                                    <!-- Remove Friend Link -->
                                    <a href="{% url 'remove_friend' friend_id %}" 
                                       class="rounded-2xl px-4 ml-2 text-white" style="background-color: red">X</a>
                                </div>
                                {% endwith %}
                            {% endif %}
                        {% empty %}
                            <p>{% trans "No friends" %}</p>
                        {% endfor %}
                    </div>
                </div>
            </div>
            
        {% else %}
            <p>{% trans "You need to log in to view your profile." %}</p>
        {% endif %}
    </div>
{% endblock content %}
